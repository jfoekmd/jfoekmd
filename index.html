<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2간단한 FPpS 게임</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #333;
      font-family: Arial, sans-serif;
    }
    
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      perspective: 800px;
      overflow: hidden;
    }
    
    #fps-view {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.05s;
    }
    
    .wall {
      position: absolute;
      background-color: #555;
      border: 1px solid #777;
      transform-style: preserve-3d;
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .floor {
      position: absolute;
      width: 2000px;
      height: 2000px;
      background-image: linear-gradient(#444 1px, transparent 1px), 
                        linear-gradient(90deg, #444 1px, transparent 1px);
      background-size: 50px 50px;
      transform: rotateX(90deg) translateZ(-20px);
      background-color: #333;
    }
    
    .enemy {
      position: absolute;
      width: 40px;
      height: 80px;
      background-color: #f00;
      border-radius: 5px;
      transform-style: preserve-3d;
      transition: background-color 0.2s;
    }
    
    .crosshair {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    
    .crosshair::before, .crosshair::after {
      content: '';
      position: absolute;
      background-color: rgba(255, 255, 255, 0.8);
    }
    
    .crosshair::before {
      width: 2px;
      height: 20px;
      left: 9px;
      top: 0;
    }
    
    .crosshair::after {
      width: 20px;
      height: 2px;
      left: 0;
      top: 9px;
    }
    
    .gun {
      position: absolute;
      bottom: 0;
      right: 50%;
      width: 200px;
      height: 150px;
      background-color: #222;
      transform: translateX(50%);
      clip-path: polygon(40% 0%, 60% 0%, 70% 50%, 100% 100%, 0% 100%, 30% 50%);
      z-index: 100;
    }
    
    .muzzle-flash {
      position: absolute;
      top: 10%;
      left: 50%;
      width: 20px;
      height: 20px;
      background-color: yellow;
      transform: translate(-50%, -50%) scale(0);
      border-radius: 50%;
      box-shadow: 0 0 10px 5px orange;
      opacity: 0;
      transition: transform 0.05s, opacity 0.05s;
    }
    
    #hud {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 18px;
      z-index: 200;
      text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
    }
    
    #ammo {
      position: absolute;
      bottom: 20px;
      right: 20px;
      color: white;
      font-size: 18px;
      z-index: 200;
      text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
    }
    
    #game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 300;
      display: none;
    }
    
    #game-over h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    
    #game-over button {
      padding: 10px 20px;
      font-size: 20px;
      background-color: #f00;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="fps-view">
      <div class="floor"></div>
      <!-- Walls will be generated by JavaScript -->
      <!-- Enemies will be generated by JavaScript -->
    </div>
    <div class="crosshair"></div>
    <div class="gun">
      <div class="muzzle-flash"></div>
    </div>
    <div id="hud">
      <div>점수: <span id="score">0</span></div>
      <div>남은 적: <span id="enemies-left">0</span></div>
      <div>체력: <span id="health">100</span></div>
    </div>
    <div id="ammo">
      <div>탄약: <span id="ammo-count">10</span> / 10</div>
      <div>R 키를 눌러 재장전</div>
    </div>
    <div id="game-over">
      <h1>게임 오버</h1>
      <button id="restart-btn">다시 시작</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 게임 요소
      const gameContainer = document.getElementById('game-container');
      const fpsView = document.getElementById('fps-view');
      const gunElement = document.querySelector('.gun');
      const muzzleFlash = document.querySelector('.muzzle-flash');
      const scoreElement = document.getElementById('score');
      const enemiesLeftElement = document.getElementById('enemies-left');
      const healthElement = document.getElementById('health');
      const ammoCountElement = document.getElementById('ammo-count');
      const gameOverScreen = document.getElementById('game-over');
      const restartBtn = document.getElementById('restart-btn');
      
      // 게임 상태
      let score = 0;
      let health = 100;
      let ammo = 10;
      let isReloading = false;
      let isGameOver = false;
      
      // 플레이어 위치 및 시점
      let playerX = 0;
      let playerZ = 0;
      let rotationX = 0;
      let rotationY = 0;
      
      // 벽 생성
      const walls = [];
      const roomSize = 500;
      const wallHeight = 200;
      
      function createWall(x, z, width, depth, rotationY = 0) {
        const wall = document.createElement('div');
        wall.className = 'wall';
        wall.style.width = `${width}px`;
        wall.style.height = `${wallHeight}px`;
        wall.style.depth = `${depth}px`;
        wall.style.transform = `translate3d(${x}px, 0, ${z}px) rotateY(${rotationY}deg)`;
        
        fpsView.appendChild(wall);
        
        walls.push({
          element: wall,
          x, z, width, depth, rotationY
        });
        
        return wall;
      }
      
      // 방 만들기
      function createRoom() {
        // 북쪽 벽
        createWall(-roomSize/2, -roomSize/2, roomSize, 10, 0);
        
        // 남쪽 벽
        createWall(-roomSize/2, roomSize/2 - 10, roomSize, 10, 0);
        
        // 서쪽 벽
        createWall(-roomSize/2, -roomSize/2, roomSize, 10, 90);
        
        // 동쪽 벽
        createWall(roomSize/2 - 10, -roomSize/2, roomSize, 10, 90);
        
        // 장애물
        createWall(-roomSize/4, -roomSize/4, roomSize/2, 10, 45);
        createWall(0, 0, roomSize/3, 10, 135);
      }
      
      // 적 생성
      const enemies = [];
      const enemyCount = 10;
      
      function createEnemy() {
        const enemy = document.createElement('div');
        enemy.className = 'enemy';
        
        // 랜덤 위치 지정
        const x = Math.random() * roomSize - roomSize/2;
        const z = Math.random() * roomSize - roomSize/2;
        
        enemy.style.transform = `translate3d(${x}px, 0, ${z}px)`;
        fpsView.appendChild(enemy);
        
        enemies.push({
          element: enemy,
          x, z,
          health: 100,
          isDead: false
        });
      }
      
      function createEnemies() {
        for (let i = 0; i < enemyCount; i++) {
          createEnemy();
        }
        updateEnemiesLeft();
      }
      
      // 업데이트 함수
      function updateCamera() {
        fpsView.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg) translate3d(${-playerX}px, 0, ${-playerZ}px)`;
      }
      
      function updateEnemiesLeft() {
        const remainingEnemies = enemies.filter(enemy => !enemy.isDead).length;
        enemiesLeftElement.textContent = remainingEnemies;
        
        if (remainingEnemies === 0) {
          victory();
        }
      }
      
      // 이동 및 충돌 검사
      const keys = {};
      const moveSpeed = 5;
      
      function checkCollision(newX, newZ) {
        // 방 경계 충돌 검사
        if (newX < -roomSize/2 + 20 || newX > roomSize/2 - 20 ||
            newZ < -roomSize/2 + 20 || newZ > roomSize/2 - 20) {
          return true;
        }
        
        // 장애물 충돌 검사 (간소화)
        return false;
      }
      
      function movePlayer() {
        if (isGameOver) return;
        
        let moveX = 0;
        let moveZ = 0;
        
        if (keys['w'] || keys['ArrowUp']) {
          moveZ -= moveSpeed * Math.cos(rotationY * Math.PI / 180);
          moveX -= moveSpeed * Math.sin(rotationY * Math.PI / 180);
        }
        if (keys['s'] || keys['ArrowDown']) {
          moveZ += moveSpeed * Math.cos(rotationY * Math.PI / 180);
          moveX += moveSpeed * Math.sin(rotationY * Math.PI / 180);
        }
        if (keys['a'] || keys['ArrowLeft']) {
          moveZ -= moveSpeed * Math.sin(rotationY * Math.PI / 180);
          moveX += moveSpeed * Math.cos(rotationY * Math.PI / 180);
        }
        if (keys['d'] || keys['ArrowRight']) {
          moveZ += moveSpeed * Math.sin(rotationY * Math.PI / 180);
          moveX -= moveSpeed * Math.cos(rotationY * Math.PI / 180);
        }
        
        const newX = playerX + moveX;
        const newZ = playerZ + moveZ;
        
        if (!checkCollision(newX, newZ)) {
          playerX = newX;
          playerZ = newZ;
          updateCamera();
        }
      }
      
      // 사격 기능
      function shoot() {
        if (isGameOver || isReloading) return;
        
        if (ammo <= 0) {
          reload();
          return;
        }
        
        // 사운드 및 시각 효과
        muzzleFlash.style.transform = 'translate(-50%, -50%) scale(1)';
        muzzleFlash.style.opacity = '1';
        
        setTimeout(() => {
          muzzleFlash.style.transform = 'translate(-50%, -50%) scale(0)';
          muzzleFlash.style.opacity = '0';
        }, 100);
        
        // 탄약 감소
        ammo--;
        ammoCountElement.textContent = ammo;
        
        // 적 명중 여부 확인
        for (const enemy of enemies) {
          if (enemy.isDead) continue;
          
          // 간단한 명중 판정 (중앙에서 발사된 광선과 적의 충돌)
          const dx = enemy.x - playerX;
          const dz = enemy.z - playerZ;
          const distance = Math.sqrt(dx * dx + dz * dz);
          
          // 적 방향과 보는 방향 계산
          const enemyAngle = Math.atan2(dx, dz) * 180 / Math.PI;
          const viewingAngle = rotationY % 360;
          
          // 각도 차이 계산
          let angleDiff = Math.abs(enemyAngle - viewingAngle) % 360;
          if (angleDiff > 180) angleDiff = 360 - angleDiff;
          
          if (distance < 300 && angleDiff < 15) {
            // 명중
            enemy.health -= 50;
            enemy.element.style.backgroundColor = '#f99';
            
            setTimeout(() => {
              if (enemy.health <= 0) {
                enemy.isDead = true;
                enemy.element.style.backgroundColor = '#222';
                score += 100;
                scoreElement.textContent = score;
                updateEnemiesLeft();
              } else {
                enemy.element.style.backgroundColor = '#f00';
              }
            }, 200);
            
            break;
          }
        }
      }
      
      function reload() {
        if (isReloading || ammo === 10) return;
        
        isReloading = true;
        ammoCountElement.textContent = "재장전 중...";
        
        setTimeout(() => {
          ammo = 10;
          ammoCountElement.textContent = ammo;
          isReloading = false;
        }, 1500);
      }
      
      // 게임 종료 기능
      function gameOver() {
        isGameOver = true;
        gameOverScreen.style.display = 'flex';
      }
      
      function victory() {
        isGameOver = true;
        gameOverScreen.querySelector('h1').textContent = '승리!';
        gameOverScreen.style.display = 'flex';
      }
      
      function restartGame() {
        // 게임 초기화
        score = 0;
        health = 100;
        ammo = 10;
        isReloading = false;
        isGameOver = false;
        
        // UI 초기화
        scoreElement.textContent = score;
        healthElement.textContent = health;
        ammoCountElement.textContent = ammo;
        gameOverScreen.style.display = 'none';
        
        // 적 제거 및 재생성
        for (const enemy of enemies) {
          if (enemy.element.parentNode) {
            enemy.element.parentNode.removeChild(enemy.element);
          }
        }
        enemies.length = 0;
        createEnemies();
        
        // 플레이어 위치 초기화
        playerX = 0;
        playerZ = 0;
        updateCamera();
      }
      
      // 적 AI (간단한 버전)
      function updateEnemies() {
        for (const enemy of enemies) {
          if (enemy.isDead) continue;
          
          // 플레이어를 향해 회전
          const dx = playerX - enemy.x;
          const dz = playerZ - enemy.z;
          const angle = Math.atan2(dx, dz) * 180 / Math.PI;
          
          enemy.element.style.transform = `translate3d(${enemy.x}px, 0, ${enemy.z}px) rotateY(${angle}deg)`;
          
          // 간단한 플레이어 공격 (가까울 때)
          const distance = Math.sqrt(dx * dx + dz * dz);
          
          if (distance < 100 && Math.random() < 0.01 && !isGameOver) {
            health -= 10;
            healthElement.textContent = health;
            
            // 화면 빨간색 깜박임 효과
            document.body.style.backgroundColor = '#500';
            setTimeout(() => {
              document.body.style.backgroundColor = '#333';
            }, 100);
            
            if (health <= 0) {
              gameOver();
            }
          }
        }
      }
      
      // 이벤트 리스너
      document.addEventListener('keydown', (e) => {
        keys[e.key.toLowerCase()] = true;
        
        // 재장전
        if (e.key.toLowerCase() === 'r') {
          reload();
        }
      });
      
      document.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
      });
      
      document.addEventListener('mousemove', (e) => {
        if (isGameOver) return;
        
        rotationY -= e.movementX * 0.2;
        rotationX += e.movementY * 0.2;
        
        // 위/아래 시선 제한
        rotationX = Math.max(-80, Math.min(80, rotationX));
        
        updateCamera();
      });
      
      document.addEventListener('mousedown', (e) => {
        if (e.button === 0) {
          shoot();
        }
      });
      
      // 마우스 포인터 잠금
      gameContainer.addEventListener('click', () => {
        gameContainer.requestPointerLock = gameContainer.requestPointerLock ||
                                          gameContainer.mozRequestPointerLock ||
                                          gameContainer.webkitRequestPointerLock;
        gameContainer.requestPointerLock();
      });
      
      // 재시작 버튼
      restartBtn.addEventListener('click', () => {
        restartGame();
      });
      
      // 게임 초기화
      function init() {
        createRoom();
        createEnemies();
        
        // 게임 루프
        setInterval(() => {
          movePlayer();
          updateEnemies();
        }, 1000 / 60);
      }
      
      // 게임 시작
      init();
    });
  </script>
</body>
</html>